{{- range .Values.projects }}
{{- $config := $.Values.config -}}
apiVersion: argoproj.io/v1alpha1
kind:  AppProject
metadata:
  name: {{ .name }}
  namespace: argocd
  finalizers:
  - resources-finalizer.argocd.argoproj.io
spec:
  description: {{ .description }}
  sourceRepos:
  - {{ $config.spec.source.repoURL }}
  {{- if $config.spec.source.additionalRepos }}
  {{- with $config.spec.source.additionalRepos }}
  {{- . | toYaml | nindent 4 }}
  {{- end }}
  {{- end }}
  destinations:
    - namespace: '*'
      server: {{ $config.spec.destination.server | quote }}
  clusterResourceWhitelist:
  - group: ''
    kind: Namespace
  # Allow all namespaced-scoped resources to be created, except for ResourceQuota, LimitRange, NetworkPolicy
  namespaceResourceBlacklist:
  - group: ''
    kind: ResourceQuota
  - group: ''
    kind: LimitRange
  - group: ''
    kind: NetworkPolicy
  # Deny all namespaced-scoped resources from being created, except for Deployment and StatefulSet
  namespaceResourceWhitelist:
  - group: 'apps'
    kind: Deployment
  - group: 'apps'
    kind: StatefulSet
  - group: networking.k8s.io
    kind: Ingress
  - group: ""
    kind: Service
---
{{ end -}}